<!DOCTYPE html>
<!-- saved from url=(0170)http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/ -->
<html dir="ltr" lang="zh-CN"><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<title>利用getImageData()对Canvas中的对象进行精确选中 | Neekey</title>
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="stylesheet" type="text/css" media="all" href="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/style.css">
<link rel="pingback" href="http://neekey.net/blog/xmlrpc.php">
<!--[if lt IE 9]>
<script src="http://neekey.net/blog/wp-content/themes/duster/html5.js" type="text/javascript"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Neekey » Feed" href="http://neekey.net/blog/feed/">
<link rel="alternate" type="application/rss+xml" title="Neekey » 评论 Feed" href="http://neekey.net/blog/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Neekey » 利用getImageData()对Canvas中的对象进行精确选中 评论 Feed" href="http://neekey.net/blog/2011/05/14/%e5%88%a9%e7%94%a8getimagedata%e5%af%b9canvas%e4%b8%ad%e7%9a%84%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c%e7%b2%be%e7%a1%ae%e9%80%89%e4%b8%ad/feed/">
<link rel="stylesheet" id="commentluv_style-css" href="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/commentluv.css" type="text/css" media="all">
<link rel="stylesheet" id="shCore-css" href="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/shCore.css" type="text/css" media="all">
<link rel="stylesheet" id="shCoreMidnight-css" href="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/shCoreMidnight.css" type="text/css" media="all">
<link rel="stylesheet" id="shThemeMidnight-css" href="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/shThemeMidnight.css" type="text/css" media="all">
<script type="text/javascript" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/l10n.js"></script>
<script type="text/javascript" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/swfobject.js"></script>
<script type="text/javascript" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/jquery.js"></script>
<script type="text/javascript">
/* <![CDATA[ */
var cl_settings = {
	name: "author",
	url: "url",
	comment: "comment",
	email: "email",
	infopanel: "",
	default_on: "on",
	default_on_admin: "",
	cl_version: "2.90.9.1",
	images: "http://neekey.net/blog/wp-content/plugins/commentluv/images/",
	api_url: "http://neekey.net/blog/wp-admin/admin-ajax.php",
	_fetch: "ea03b556cb",
	_info: "1fb9ac1ae7",
	infoback: "white",
	infotext: "",
	template_insert: "",
	logged_in: "",
	refer: "http://neekey.net/blog/2011/05/14/%e5%88%a9%e7%94%a8getimagedata%e5%af%b9canvas%e4%b8%ad%e7%9a%84%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c%e7%b2%be%e7%a1%ae%e9%80%89%e4%b8%ad/",
	no_url_message: "输入网址，然后点击CommentLuv前的复选框就可以分享你的最新博客文章。",
	no_http_message: "确保网址前面有 http:// 字样",
	no_url_logged_in_message: "在控制板中个人设置页面更新你的网站的详细信息。",
	no_info_message: "找不到信息或者出错。"
};
/* ]]> */
</script>
<script type="text/javascript" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/commentluv.js"></script>
<script type="text/javascript" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/comment-reply.js"></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://neekey.net/blog/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://neekey.net/blog/wp-includes/wlwmanifest.xml"> 
<link rel="index" title="Neekey" href="http://neekey.net/blog/">
<link rel="start" title="Hello world！" href="http://neekey.net/blog/2011/04/14/hello-world/">
<link rel="prev" title="JavaScript Image Preloader" href="http://neekey.net/blog/2011/05/13/javascript-image-preloader/">
<link rel="next" title="SSH 翻墙简易教程( Chrome/Firefox + Tunnelier )" href="http://neekey.net/blog/2011/05/16/ssh-%e7%bf%bb%e5%a2%99%e7%ae%80%e6%98%93%e6%95%99%e7%a8%8b-chromefirefox-tunnelier/">
<meta name="generator" content="WordPress 3.2.1">
<link rel="canonical" href="http://neekey.net/blog/2011/05/14/%e5%88%a9%e7%94%a8getimagedata%e5%af%b9canvas%e4%b8%ad%e7%9a%84%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c%e7%b2%be%e7%a1%ae%e9%80%89%e4%b8%ad/">
<link rel="shortlink" href="http://neekey.net/blog/?p=152">
</head>

<body class="single single-post postid-152 single-format-standard singular">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
			<hgroup>
				<div id="myAvatar"><img src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/neekeyAvatar.jpg"></div>
				<h1 id="site-title"><span><a href="http://neekey.net/blog/" title="Neekey" rel="home">Neekey</a></span>
</h1>
				<h2 id="site-description">在这里记录我的学习生活</h2>
			</hgroup>
			
			<!-- @neekey remove Header 2011 5 11  -->

								<form method="get" id="searchform" action="http://neekey.net/blog">
			<input type="text" class="field" name="s" id="s" placeholder="Search">
			<input type="submit" class="submit" name="submit" id="searchsubmit" value="Search">
	</form>
			
			<nav id="access" role="navigation">
				<h1 class="section-heading">Main menu</h1>
				<div class="skip-link screen-reader-text"><a href="http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/#content" title="Skip to content">Skip to content</a></div>

				<div class="menu-neekey-wiki-container"><ul id="menu-neekey-wiki" class="menu"><li id="menu-item-349" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-349"><a href="http://neekey.net/blog/">首页</a></li>
<li id="menu-item-348" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-348"><a href="http://neekey.net/blog/%e7%95%99%e8%a8%80%e6%9d%bf/">留言板</a></li>
<li id="menu-item-347" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-347"><a href="http://neekey.net/wiki">DokuWiki</a></li>
</ul></div>			</nav><!-- #access -->
	</header><!-- #branding -->


	<div id="main">
		<div id="primary">
			<div id="content" role="main">

				
					<nav id="nav-single">
						<h1 class="section-heading">Post navigation</h1>
						<span class="nav-previous"><a href="http://neekey.net/blog/2011/05/13/javascript-image-preloader/" rel="prev">← Previous</a></span>
						<span class="nav-next"><a href="http://neekey.net/blog/2011/05/16/ssh-%e7%bf%bb%e5%a2%99%e7%ae%80%e6%98%93%e6%95%99%e7%a8%8b-chromefirefox-tunnelier/" rel="next">Next →</a></span>
					</nav><!-- #nav-single -->

					
<article id="post-152" class="post-152 post type-post status-publish format-standard hentry category-canvas category-javascript tag-canvas tag-javascript">
	<header class="entry-header">
		<h1 class="entry-title">利用getImageData()对Canvas中的对象进行精确选中</h1>

		<div class="entry-meta">
			<span class="sep">Posted on </span><a href="http://neekey.net/blog/2011/05/14/%e5%88%a9%e7%94%a8getimagedata%e5%af%b9canvas%e4%b8%ad%e7%9a%84%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c%e7%b2%be%e7%a1%ae%e9%80%89%e4%b8%ad/" rel="bookmark"><time class="entry-date" datetime="2011-05-14T02:59:25+00:00" pubdate="">2011 年 05 月 14 日</time></a> <span class="sep"> by </span> <span class="author vcard"><a class="url fn n" href="http://neekey.net/blog/author/neekey/" title="View all posts by neekey">neekey</a></span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p>这两天一直在做游戏，昨天遇到一个问题，就是如何精确的选中canvas画布中的角色：<br>
<a href="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/2011-05-14_103531.png"><img class="alignnone size-full wp-image-153" title="2011-05-14_103531" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/2011-05-14_103531.png" alt="" width="281" height="249"></a><br>
<span id="more-152"></span><br>
这个场景中，每个角色都有一张8方向png图片，来存储各个方向的走动信息：<br>
<a href="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/1.png"><img class="alignnone size-full wp-image-154" title="1" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/1.png" alt="" width="280" height="992"></a></p>
<p>在游戏中每个角色存储了这样一些信息：</p>
<div><div id="highlighter_96544" class="syntaxhighlighter  jscript"><div class="toolbar"><span><a href="http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2">13</div><div class="line number14 index13 alt1">14</div><div class="line number15 index14 alt2">15</div><div class="line number16 index15 alt1">16</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">roBob = </code><code class="jscript keyword">function</code><code class="jscript plain">( dir, offset, posX, posY ){</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.amLength = 4;&nbsp;&nbsp;&nbsp; </code><code class="jscript comments">//每个动画的帧数</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.amW = 70;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="jscript comments">//每个帧数动画的宽度</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.amH = 124;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="jscript comments">//每个帧数动画的高度</code></div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.amIndex = 0;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="jscript comments">//当前动画执行到的帧序列号</code></div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.amType = dir;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="jscript comments">//当前动画类别（人物走动方向）</code></div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.offset = offset;&nbsp;&nbsp; </code><code class="jscript comments">//动画延迟（速度）</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.offsetIndex = 0;</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.amId;</code></div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.canContext;</code></div><div class="line number11 index10 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.posX = posX;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code><code class="jscript comments">//人物当前在画布中的坐标</code></div><div class="line number12 index11 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.posY = posY;</code></div><div class="line number13 index12 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">this</code><code class="jscript plain">.active = </code><code class="jscript keyword">false</code><code class="jscript plain">;</code></div><div class="line number14 index13 alt1">&nbsp;</div><div class="line number15 index14 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">amController.list.push( </code><code class="jscript keyword">this</code> <code class="jscript plain">);</code></div><div class="line number16 index15 alt1"><code class="jscript plain">}</code></div></div></td></tr></tbody></table></div></div>
<p>那么一开始，我只是进行了简单的包围盒式判断：</p>
<div><div id="highlighter_311715" class="syntaxhighlighter  jscript"><div class="toolbar"><span><a href="http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="jscript plain">amController.cans.addEventListener( </code><code class="jscript string">'click'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">( e ){ </code><code class="jscript comments">/* 这个是全局控制器 */</code></div><div class="line number2 index1 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">var</code> <code class="jscript plain">x = e.offsetX,&nbsp; y = e.offsetY, i, bob, pixelData;</code></div><div class="line number3 index2 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">// 遍历人物 查看是否被选中</code></div><div class="line number4 index3 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">for</code><code class="jscript plain">( i = 0; bob = amController.list[ i ]; i++ ){</code></div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">if</code><code class="jscript plain">( x &gt; bob.posX &amp;&amp; x &lt; bob.posX + bob.amW &amp;&amp; y &gt; bob.posY &amp;&amp; y &lt; bob.posY + bob.amH ){</code></div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript comments">//若点击点在人物的包围盒内</code></div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">bob.active = </code><code class="jscript keyword">true</code><code class="jscript plain">;</code></div><div class="line number8 index7 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript keyword">break</code><code class="jscript plain">;</code></div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number10 index9 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">}</code></div><div class="line number11 index10 alt2"><code class="jscript plain">});</code></div></div></td></tr></tbody></table></div></div>
<p>很明显，这种方式不够准确，我们在人物周围的空白地方点击，人物照样会被选中！那该怎么办呢？<br>
后来问了一下群里的朋友，得到的结论是只能通过像素信息来判断。于是在canvas的api中找到getImageData这个方法：</p>
<blockquote><p>imagedata = context . getImageData(sx, sy, sw, sh)<br>
Returns an ImageData object containing the image data for the given rectangle of the canvas.</p>
<p>If any of the arguments are not finite, throws a NOT_SUPPORTED_ERR exception.</p>
<p>If the either the width or height argument is zero, throws an INDEX_SIZE_ERR exception</p></blockquote>
<blockquote><p>imagedata . data<br>
Returns the one-dimensional array containing the data for the ImageData object.</p>
<p>imagedata . height<br>
Returns the actual dimensions of the data in the ImageData object, in device pixels.</p>
<p>imagedata . width<br>
Returns the actual dimensions of the data in the ImageData object, in device pixels
</p></blockquote>
<p>也就是，我们可以通过Canvas的CanvasRenderingContext2D对象来获取画布中指定区域的像素信息如：</p>
<div><div id="highlighter_533651" class="syntaxhighlighter  jscript"><div class="toolbar"><span><a href="http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">context = can.getContext(</code><code class="jscript string">'2d'</code><code class="jscript plain">);</code></div><div class="line number2 index1 alt1"><code class="jscript comments">/* 获取画布中0.0 坐标处,宽10，高20的区域像素信息 */</code></div><div class="line number3 index2 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">imgData = context.getImageData(0, 0, 10, 20 );</code></div></div></td></tr></tbody></table></div></div>
<p>imgData有三个属性：<br>
<strong>data</strong><br>
以一维数组的形式存储的像素信息，如:<br>
[75, 30, 40, 255, 80, 60, 50, 0]<br>
这里存储了两个点的信息，第一个点是index从0到3，第二个点是4到7<br>
每个点的四个数量分别代表red, green, blue, alpha<br>
并且像素的排列顺序是从左到右，从上到下<br>
<strong>width </strong><br>
区域宽度<br>
<strong>height</strong><br>
区域高度</p>
<p>那么有了这些信息，我们只需要判断点击点在原图中的信息是否透明度不为0，就能准确地定位了！<br>
要实现这个方法，在一开始我们就必须将原图的ImageData保存起来,我的做法是建立一个在内存中的canvas，然后读取信息：</p>
<div><div id="highlighter_521129" class="syntaxhighlighter  jscript"><div class="toolbar"><span><a href="http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/#" class="toolbar_item command_help help">?</a></span></div><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="jscript plain">img1.src = </code><code class="jscript string">'../img/RO/1.png'</code><code class="jscript plain">;</code></div><div class="line number2 index1 alt1"><code class="jscript comments">/* 创造一个 canvas 用于存储bob图像像素信息 */</code></div><div class="line number3 index2 alt2"><code class="jscript keyword">var</code> <code class="jscript plain">imgCanvas, imgData, imgContext, imgDataArray;</code></div><div class="line number4 index3 alt1"><code class="jscript plain">img1.addEventListener( </code><code class="jscript string">'load'</code><code class="jscript plain">, </code><code class="jscript keyword">function</code><code class="jscript plain">(){</code></div><div class="line number5 index4 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">imgCanvas = fn.html(</code><code class="jscript string">'&lt;canvas width="'</code> <code class="jscript plain">+ img1.width + </code><code class="jscript string">'" height="'</code> <code class="jscript plain">+ img1.height + </code><code class="jscript string">'" &gt;&lt;/canvas&gt;'</code><code class="jscript plain">);</code></div><div class="line number6 index5 alt1"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">imgContext = imgCanvas.getContext( </code><code class="jscript string">'2d'</code> <code class="jscript plain">);</code></div><div class="line number7 index6 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">imgContext.drawImage( img1, 0, 0 );</code></div><div class="line number8 index7 alt1">&nbsp;</div><div class="line number9 index8 alt2"><code class="jscript spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="jscript plain">imgDataArray = imgContext.getImageData( 0, 0, img1.width, img1.height );</code></div><div class="line number10 index9 alt1"><code class="jscript plain">} );</code></div></div></td></tr></tbody></table></div></div>
<p>当然要记得将imgCanvas从内存中释放<br>
然后我们每次点击后只要将当前点映射到imgDataArray.data这个数组中，并判断 透明度是否为0就可以了！</p>
<p>可能有点抽象，希望大家自己实践下~呵呵</p>

<!-- Begin anyShare -->
<link rel="stylesheet" href="http://neekey.net/blog/wp-content/plugins/anyshare/anyShare.css?v=5"><table id="anyShare"><tbody><tr><td id="AS-TXT"><i>anyShare</i><b>分享到：</b></td><td id="AS-IMG" rowspan="2"><img src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/chart"></td></tr><tr><td id="AS-BTN"><a id="sntwet" title="新浪微博" href="http://v.t.sina.com.cn/share/share.php?url=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F" target="_blank">&nbsp;</a><a id="qqtwet" title="腾讯微博" href="http://v.t.qq.com/share/share.php?appkey=2e295ab2ff8245229d96fa3768a9f779&url=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F&title=%E5%88%A9%E7%94%A8getImageData%28%29%E5%AF%B9Canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD" target="_blank">&nbsp;</a><a id="qqzone" title="腾讯空间" href="http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F" target="_blank">&nbsp;</a><a id="renren" title="人人社区" href="http://share.renren.com/share/buttonshare.do?link=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F&title=%E5%88%A9%E7%94%A8getImageData%28%29%E5%AF%B9Canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD" target="_blank">&nbsp;</a><a id="kaixin" title="开心社区" href="http://www.kaixin001.com/repaste/share.php?rurl=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F&rtitle=%E5%88%A9%E7%94%A8getImageData%28%29%E5%AF%B9Canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD" target="_blank">&nbsp;</a><a id="douban" title="豆瓣社区" href="http://www.douban.com/recommend/?url=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F" target="_blank">&nbsp;</a><a id="bdcang" title="百度搜藏" href="http://cang.baidu.com/do/add?iu=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F&it=%E5%88%A9%E7%94%A8getImageData%28%29%E5%AF%B9Canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD" target="_blank">&nbsp;</a><a id="folow5" title="Follow5" href="http://www.follow5.com/f5/discuz/sharelogin.jsp?url=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F&title=%E5%88%A9%E7%94%A8getImageData%28%29%E5%AF%B9Canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD" target="_blank">&nbsp;</a><a id="facebk" title="facebook" href="http://www.facebook.com/share.php?u=http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F" target="_blank">&nbsp;</a><a id="twiter" title="twitter" href="http://twitter.com/home?status=%E5%88%A9%E7%94%A8getImageData%28%29%E5%AF%B9Canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD-http%3A%2F%2Fneekey.net%2Fblog%2F2011%2F05%2F14%2F%25e5%2588%25a9%25e7%2594%25a8getimagedata%25e5%25af%25b9canvas%25e4%25b8%25ad%25e7%259a%2584%25e5%25af%25b9%25e8%25b1%25a1%25e8%25bf%259b%25e8%25a1%258c%25e7%25b2%25be%25e7%25a1%25ae%25e9%2580%2589%25e4%25b8%25ad%2F" target="_blank">&nbsp;</a><br clear="all"></td></tr></tbody></table>
<!-- anyShare Endof -->
			</div><!-- .entry-content -->

	<footer class="entry-meta">		
		This entry was posted in <a href="http://neekey.net/blog/category/canvas/" title="查看 canvas 中的全部文章" rel="category tag">canvas</a>, <a href="http://neekey.net/blog/category/javascript/" title="查看 JavaScript 中的全部文章" rel="category tag">JavaScript</a> and tagged <a href="http://neekey.net/blog/tag/canvas/" rel="tag">canvas</a>, <a href="http://neekey.net/blog/tag/javascript/" rel="tag">JavaScript</a> by <a href="http://neekey.net/blog/author/neekey/">neekey</a>. Bookmark the <a href="http://neekey.net/blog/2011/05/14/%e5%88%a9%e7%94%a8getimagedata%e5%af%b9canvas%e4%b8%ad%e7%9a%84%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c%e7%b2%be%e7%a1%ae%e9%80%89%e4%b8%ad/" title="Permalink to 利用getImageData()对Canvas中的对象进行精确选中" rel="bookmark">permalink</a>.				
			</footer><!-- .entry-meta -->
</article><!-- #post-152 -->

					
					
	<div id="comments">
	
	
			<h2 id="comments-title">
			One thought on “<span>利用getImageData()对Canvas中的对象进行精确选中</span>”		</h2>

		
		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-19">
		<article id="comment-19" class="comment">
			<footer class="comment-meta">
				<div class="comment-author vcard">
					<img alt="" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/dac67663e506cbdeb7bac75fffb91c4e" class="avatar avatar-68 photo" height="68" width="68"><cite class="fn"><a href="http://kainy.cn/feed/" rel="external nofollow" class="url">freetao</a></cite> on <a href="http://neekey.net/blog/2011/05/14/%e5%88%a9%e7%94%a8getimagedata%e5%af%b9canvas%e4%b8%ad%e7%9a%84%e5%af%b9%e8%b1%a1%e8%bf%9b%e8%a1%8c%e7%b2%be%e7%a1%ae%e9%80%89%e4%b8%ad/#comment-19"><time pubdate="" datetime="2011-06-21T02:02:00+00:00">2011 年 06 月 21 日 at 上午 2:02</time></a> <span class="says">said:</span>					
										
				</div><!-- .comment-author .vcard -->

				
			</footer>

			<div class="comment-content"><p>确实有几分抽象。。。<br>
<span class="cluv">freetao recently posted..<a class="88357c8183 19" rel="nofollow" href="http://item.feedsky.com/~feedsky/Kainycn/~8609763/510220307/6124941/1/item.html">一名web前端开发新兵的名片</a></span></p>
</div>

			<div class="reply">
				<a class="comment-reply-link" href="http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/?replytocom=19#respond" onclick="return addComment.moveForm(&quot;comment-19&quot;, &quot;19&quot;, &quot;respond&quot;, &quot;152&quot;)">Reply ↓</a>			</div><!-- .reply -->
		</article><!-- #comment-##  -->

	</li>
		</ol>

		
	
									<div id="respond">
				<h3 id="reply-title">发表评论 <small><a rel="nofollow" id="cancel-comment-reply-link" href="http://neekey.net/blog/2011/05/14/%E5%88%A9%E7%94%A8getimagedata%E5%AF%B9canvas%E4%B8%AD%E7%9A%84%E5%AF%B9%E8%B1%A1%E8%BF%9B%E8%A1%8C%E7%B2%BE%E7%A1%AE%E9%80%89%E4%B8%AD/#respond" style="display:none;">取消回复</a></small></h3>
									<form action="http://neekey.net/blog/wp-comments-post.php" method="post" id="commentform">
																			<p class="comment-notes">电子邮件地址不会被公开。 必填项已用 <span class="required">*</span> 标注</p>							<p class="comment-form-author"><label for="author">姓名</label> <span class="required">*</span><input id="author" name="author" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-email"><label for="email">电子邮件</label> <span class="required">*</span><input id="email" name="email" type="text" value="" size="30" aria-required="true"></p>
<p class="comment-form-url"><label for="url">站点</label><input id="url" name="url" type="text" value="" size="30"></p>
												<p class="comment-form-comment"><label for="comment">评论</label><textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">您可以使用这些 <abbr title="HyperText Markup Language">HTML</abbr> 标签和属性： <code>&lt;a href="" title=""&gt; &lt;abbr title=""&gt; &lt;acronym title=""&gt; &lt;b&gt; &lt;blockquote cite=""&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=""&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=""&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="发表评论">
							<input type="hidden" name="comment_post_ID" value="152" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
						</p>
						<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="23564c4660"></p><input type="hidden" name="cl_post_title" id="cl_post_title" value=""><input type="hidden" name="cl_post_url" id="cl_post_url" value=""><input type="hidden" name="cl_prem" id="cl_prem" value=""><div id="commentluv"><div id="cl_messages"></div><input type="checkbox" id="doluv" name="doluv" checked="checked"><span id="mylastpost"><img alt="CommentLuv badge" src=""></span><span id="showmorespan"><img class="clarrow" id="showmore" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/down-arrow.gif" alt="显示更多文章" title="显示更多文章" style="display:none;"></span></div><div id="lastposts" style="display:none;"></div>					</form>
							</div><!-- #respond -->
						
</div><!-- #comments -->
				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">
		
					
			<div id="site-generator">
				<a href="http://wordpress.org/" rel="generator">Proudly powered by WordPress</a><span class="sep"> | </span>Theme: Duster by <a href="http://automattic.com/" rel="designer">Automattic</a>.			</div>
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/shCore.js"></script>
<script type="text/javascript" src="./利用getImageData()对Canvas中的对象进行精确选中   Neekey_files/shBrushJScript.js"></script>
<script type="text/javascript">//<![CDATA[
SyntaxHighlighter.all();
//]]></script>

<span id="heart_tip_big" style="position: absolute; z-index: 1001; background-color: white; width: 62px; display: none; "></span></body></html>